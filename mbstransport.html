<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Login & Register</title>
  <style>
    .box { display: none; }
    .active { display: block; }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="box active">
  <h2>Login</h2>
  <input id="loginNick" placeholder="Nickname"><br>
  <input id="loginPass" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <br><br>
  <a href="#" onclick="switchBox('registerBox')">Go to Register</a>
</div>

<!-- REGISTER -->
<div id="registerBox" class="box">
  <h2>TANYA ADMIN UNTUK REGISTER</h2>
  <a href="#" onclick="switchBox('loginBox')">Back to Login</a>
</div>

<script>
// ===== 切换登录/注册 =====
function switchBox(id) {
  document.querySelectorAll('.box').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ===== Google Apps Script Web App URL =====
const API = "https://script.google.com/macros/s/AKfycbz2vbEE8RJEPlgbmyVfObQ9CcAjFki4drcaJqa_BbGqcjk7bVoQ_OqItwUie7VgDS4tIw/exec";

// ===== REGISTER =====
function register() {
  let nick = document.getElementById("regNick").value.trim();
  let pass = document.getElementById("regPass").value;
  let pass2 = document.getElementById("regPass2").value;

  if (!nick || !pass) return alert("Please fill in all fields");
  if (pass !== pass2) return alert("Passwords do not match");

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "register",
      nickname: nick,
      password: pass
    })
  })
  .then(r => r.json())
  .then(data => {
    alert(data.message);
    if (data.status === "ok") switchBox("loginBox");
  });
}

// ===== LOGIN =====
function login() {
  let nick = document.getElementById("loginNick").value.trim();
  let pass = document.getElementById("loginPass").value;

  if (!nick || !pass) return alert("Please enter nickname & password");

  fetch(API + "?action=login&nickname=" + nick + "&password=" + pass)
    .then(r => r.json())
    .then(data => {

      if (data.status !== "ok") return alert(data.message);

      // 保存用户数据到 localStorage（跨页面保持登录）
      localStorage.setItem("nickname", data.user.nickname);
      localStorage.setItem("branch", data.user.branch);

      // 跳转到 dashboard
      window.location.href = "dashboard.html";
    });
}
</script>
</body>
</html>
